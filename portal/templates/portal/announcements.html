{% extends "portal/base.html" %}
{% block title %}Announcements{% endblock %}
{% block content %}
<div class="container-fluid animate__animated animate__fadeIn">
    {% if pinned %}
    <div class="alert alert-danger d-flex align-items-center mb-4 shadow-sm" style="font-size:1.1rem;">
        <i class="fa fa-thumbtack fa-lg me-3"></i>
        <div>
            <strong>{{ pinned.title }}</strong><br>
            <span class="small text-muted">{{ pinned.created_at|date:'M j, Y' }}{% if pinned.author %} &middot; {{ pinned.author.get_full_name }}{% endif %} &middot; <span class="badge bg-warning text-dark">Pinned</span></span>
            <div class="mt-1">{{ pinned.message|linebreaks }}</div>
        </div>
    </div>
    {% endif %}
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h4 class="fw-bold mb-3"><i class="fa fa-bullhorn text-danger me-2"></i>Announcements</h4>
            <ul class="list-group list-group-flush" id="announcementFeed">
                {% for ann in feed %}
                <li class="list-group-item announcement-item">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <span class="fw-bold">{{ ann.title }}</span>
                            <span class="small text-muted ms-2">{{ ann.created_at|date:'M j, Y' }}{% if ann.author %} &middot; {{ ann.author.get_full_name }}{% endif %}</span>
                            <span class="badge bg-secondary ms-2">{{ ann.get_category_display }}</span>
                        </div>
                        <button class="btn btn-link btn-sm text-primary toggle-announcement" data-ann-id="{{ ann.id }}" aria-expanded="false" aria-controls="ann-content-{{ ann.id }}"><i class="fa fa-chevron-down"></i></button>
                    </div>
                    <div class="announcement-preview mt-2" id="ann-content-{{ ann.id }}" style="display:none;">
                        {{ ann.message|linebreaks }}
                    </div>
                    <div class="announcement-short mt-2 text-muted small">
                        {{ ann.message|truncatechars:120 }}
                    </div>
                </li>
                {% empty %}
                <li class="list-group-item">No announcements found.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.toggle-announcement').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var id = btn.getAttribute('data-ann-id');
                var content = document.getElementById('ann-content-' + id);
                var short = btn.closest('.announcement-item').querySelector('.announcement-short');
                var expanded = btn.getAttribute('aria-expanded') === 'true';
                if (expanded) {
                    content.style.display = 'none';
                    short.style.display = '';
                    btn.setAttribute('aria-expanded', 'false');
                    btn.querySelector('i').classList.remove('fa-chevron-up');
                    btn.querySelector('i').classList.add('fa-chevron-down');
                } else {
                    content.style.display = '';
                    short.style.display = 'none';
                    btn.setAttribute('aria-expanded', 'true');
                    btn.querySelector('i').classList.remove('fa-chevron-down');
                    btn.querySelector('i').classList.add('fa-chevron-up');
                }
            });
        });
    });
</script>
{% endblock %} 