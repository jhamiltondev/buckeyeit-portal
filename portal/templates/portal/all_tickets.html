{% extends "portal/base.html" %}
{% load static %}
{% block title %}All Tickets{% endblock %}
{% block content %}
<div class="container-fluid animate__animated animate__fadeIn">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm mt-4">
                <div class="card-body">
                    <h4 class="fw-bold mb-3"><i class="fa fa-folder-open text-secondary me-2"></i>All Open Tickets</h4>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ticket in tickets %}
                                <tr>
                                    <td>{{ ticket.subject }}</td>
                                    <td><span class="badge bg-warning text-dark">Open</span></td>
                                    <td>{{ ticket.created_at|date:"Y-m-d" }}</td>
                                </tr>
                                {% endfor %}
                                {% for ticket in cw_tickets %}
                                <tr>
                                    <td>{{ ticket.summary }} <span class="badge bg-secondary ms-1">ConnectWise</span>
                                        {% if ticket.id in cw_ticket_notes %}
                                            <div class="mt-2 inbox-messages">
                                                <div class="fw-bold small text-muted mb-1">Messages/Updates:</div>
                                                {% for note in cw_ticket_notes[ticket.id] %}
                                                    <div class="inbox-message mb-2 p-2 rounded bg-light border">
                                                        <div class="small text-secondary mb-1">
                                                            <i class="fa fa-user-circle me-1"></i>
                                                            {{ note.enteredBy }}
                                                            <span class="mx-2">|</span>
                                                            <i class="fa fa-clock me-1"></i>
                                                            {{ note.dateCreated|slice:":10" }} {{ note.timeCreated|default:"" }}
                                                        </div>
                                                        <div>{{ note.text }}</div>
                                                    </div>
                                                {% empty %}
                                                    <div class="small text-muted">No messages yet.</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </td>
                                    <td><span class="badge bg-warning text-dark">Open</span></td>
                                    <td>{{ ticket.dateEntered|slice:":10" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
.inbox-messages { font-size: 0.97em; }
.inbox-message { box-shadow: 0 1px 4px rgba(0,0,0,0.04); }
</style>
{% endblock %} 